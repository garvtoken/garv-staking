<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>GARV Token Staking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

<style>
  body {
    background:#0b1220;
    color:#fff;
    font-family:Arial, sans-serif;
  }
  .box {
    max-width:420px;
    margin:40px auto;
    background:#121a2b;
    padding:20px;
    border-radius:12px;
  }
  h2 { text-align:center; }

  input, button {
    width:100%;
    padding:14px;
    margin-top:10px;
    border:none;
    border-radius:8px;
    font-size:16px;
  }

  .primary {
    background:#2563eb;
    color:#fff;
  }

  .gray {
    background:#374151;
    color:#9ca3af;
  }

  .disabled {
    background:#1f2937;
    color:#6b7280;
  }

  .info {
    background:#0f172a;
    padding:12px;
    border-radius:8px;
    margin-top:15px;
    font-size:14px;
  }

  .small { font-size:13px; color:#9ca3af; margin-top:10px; }
</style>
</head>

<body>

<div class="box">
  <h2>GARV Token Staking</h2>
  <div id="walletStatus" class="small">Wallet: Not Connected</div>

  <button id="connectBtn" class="primary" onclick="connectWallet()">Connect Wallet</button>

  <input id="amount" placeholder="Enter GARV amount" />

  <button id="approveBtn" class="disabled" disabled onclick="approve()">Approve GARV</button>
  <button id="stakeBtn" class="disabled" disabled onclick="stake()">Stake GARV</button>

  <div class="info">
    <b>Your Stake Info</b><br>
    Staked: <span id="staked">0</span><br>
    Unlock In: <span id="countdown">--</span>
  </div>

  <button id="withdrawBtn" class="disabled" disabled onclick="withdraw()">Withdraw Locked</button>

  <div class="small">
    üîí Lock Period: 365 Days<br>
    üí∞ Minimum: 15 USDT worth GARV<br>
    üîç Non-custodial ‚Ä¢ On-chain ‚Ä¢ Transparent
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const CHAIN_ID = 56; // BSC Mainnet
const GARV_TOKEN = "YOUR_GARV_TOKEN_ADDRESS";
const STAKING_CONTRACT = "YOUR_STAKING_CONTRACT";

const TOKEN_ABI = [
  "function approve(address,uint256) external returns(bool)",
  "function decimals() view returns(uint8)"
];

const STAKING_ABI = [
  "function stake(uint256) external",
  "function withdraw() external",
  "function getStakeInfo(address) view returns(uint256,uint256,uint256)"
];

/* ================= STATE ================= */
let provider, signer, user, token, staking, decimals = 18, timer;

/* ================= WALLET ================= */
async function connectWallet() {
  if (!window.ethereum) return alert("Open in MetaMask / TokenPocket");

  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  user = await signer.getAddress();

  const net = await provider.getNetwork();
  if (net.chainId !== CHAIN_ID) return alert("Switch to BSC Mainnet");

  token = new ethers.Contract(GARV_TOKEN, TOKEN_ABI, signer);
  staking = new ethers.Contract(STAKING_CONTRACT, STAKING_ABI, signer);

  try { decimals = await token.decimals(); } catch {}

  document.getElementById("walletStatus").innerText =
    "Connected: " + user.slice(0,6) + "..." + user.slice(-4);

  const btn = document.getElementById("connectBtn");
  btn.innerText = "Wallet Connected";
  btn.disabled = true;
  btn.className = "gray";

  document.getElementById("approveBtn").disabled = false;
  document.getElementById("approveBtn").className = "primary";

  document.getElementById("stakeBtn").disabled = false;
  document.getElementById("stakeBtn").className = "primary";

  loadStake();
}

/* ================= ACTIONS ================= */
async function approve() {
  const amt = document.getElementById("amount").value;
  if (!amt) return alert("Enter amount");
  const val = ethers.utils.parseUnits(amt, decimals);
  const tx = await token.approve(STAKING_CONTRACT, val);
  await tx.wait();
  alert("Approve Successful");
}

async function stake() {
  const amt = document.getElementById("amount").value;
  if (!amt) return alert("Enter amount");
  const val = ethers.utils.parseUnits(amt, decimals);
  const tx = await staking.stake(val);
  await tx.wait();
  alert("Stake Successful");
  loadStake();
}

async function withdraw() {
  const tx = await staking.withdraw();
  await tx.wait();
  alert("Withdraw Successful");
  loadStake();
}

/* ================= LOAD INFO ================= */
async function loadStake() {
  const info = await staking.getStakeInfo(user);
  document.getElementById("staked").innerText =
    ethers.utils.formatUnits(info[0], decimals);
  startTimer(Number(info[2]) * 1000);
}

/* ================= TIMER ================= */
function startTimer(unlock) {
  const btn = document.getElementById("withdrawBtn");
  clearInterval(timer);

  timer = setInterval(() => {
    const diff = unlock - Date.now();

    if (diff <= 0) {
      document.getElementById("countdown").innerText = "Unlocked";
      btn.disabled = false;
      btn.className = "primary";
      btn.innerText = "Withdraw GARV";
      clearInterval(timer);
    } else {
      btn.disabled = true;
      btn.className = "disabled";
      btn.innerText = "Withdraw Locked";

      const d = Math.floor(diff / 86400000);
      const h = Math.floor(diff / 3600000) % 24;
      const m = Math.floor(diff / 60000) % 60;
      document.getElementById("countdown").innerText =
        ${d}d ${h}h ${m}m;
    }
  }, 1000);
}
</script>

</body>
</html>
