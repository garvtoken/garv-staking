<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GARV Token | Official Staking DApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:linear-gradient(135deg,#041a2d,#0b3d5c);color:#fff;padding:20px}
.container{max-width:560px;margin:auto}
.card{background:rgba(255,255,255,.08);border-radius:18px;padding:18px;margin-bottom:18px}
h1{text-align:center}
h2{font-size:18px}
input{width:100%;padding:14px;border-radius:12px;border:none;margin-bottom:10px}
.btn{width:100%;padding:14px;border:none;border-radius:14px;font-size:16px;font-weight:bold;cursor:pointer;color:#fff}
.blue{background:#0984e3}
.green{background:#10ac84}
.red{background:#c0392b}
.gray{background:#636e72}
.badge{text-align:center;padding:8px;border-radius:10px;background:rgba(255,255,255,.12);margin-bottom:6px}
.small{font-size:13px;opacity:.85}
.footer{text-align:center;font-size:13px;opacity:.7}
table{width:100%;font-size:13px}
td{padding:6px}
iframe{width:100%;height:360px;border-radius:12px;border:none}
</style>
</head>

<body>
<div class="container">

<div class="card">
<h1>GARV Token Stake Now</h1>
<div class="badge" id="wallet">Wallet: Not Connected</div>
<button class="btn blue" onclick="connectWallet()">Connect Wallet</button>
</div>

<div class="card">
<h2>ðŸ“ˆ Live GARV Price</h2>
<div class="badge" id="price">Loading...</div>
<iframe src="https://dexscreener.com/bsc/0x00bb266615faeaae9d9d5b17668829580a038b9b"></iframe>
</div>

<div class="card">
<h2>ðŸ”’ Stake GARV</h2>
<input id="amount" type="number" placeholder="Enter GARV amount">
<div class="badge" id="usdValue">â‰ˆ 0 USDT</div>
<button id="stakeBtn" class="btn green" onclick="stake()">Approve & Stake</button>
</div>

<div class="card">
<h2>ðŸ‘¤ My Stake</h2>
<table>
<tr><td>Status</td><td id="status">-</td></tr>
<tr><td>Amount</td><td id="stakedAmt">-</td></tr>
<tr><td>Unlock Time</td><td id="unlock">-</td></tr>
<tr><td>Countdown</td><td id="countdown">-</td></tr>
</table>
<button class="btn blue" onclick="loadStake()">Refresh</button><br><br>
<button class="btn green" onclick="withdraw()">Withdraw (After Unlock)</button>
</div>

<div class="card">
<h2>ðŸš¨ Emergency</h2>
<div class="badge" id="emergencyStatus">Checking...</div>
<button class="btn red" onclick="emergencyWithdraw()">Emergency Withdraw</button>
</div>

<div class="card">
<h2>ðŸ“œ Stake History</h2>
<div id="history" class="small">Load wallet to view history</div>
</div>

<div class="card">
<h2>ðŸ›¡ Security & Risk Disclosure</h2>
<ul class="small">
<li>No guaranteed returns</li>
<li>Market volatility applies</li>
<li>Smart contract based staking</li>
<li>User responsible for wallet security</li>
</ul>
<p class="small">
Token: 0x15e4f5092af30ea702dcbac71194ccf08885688d<br>
Staking: 0xf5be3BbA8FB7cd06380b8D902eA976F0fAc8387F
</p>
</div>

<div class="footer">
On-chain â€¢ Transparent â€¢ Non-custodial â€¢ Community Driven
</div>

</div>

<script>
// CONSTANTS
const TOKEN="0x15e4f5092af30ea702dcbac71194ccf08885688d";
const STAKE="0xf5be3BbA8FB7cd06380b8D902eA976F0fAc8387F";
const PAIR="0x00bb266615faeaae9d9d5b17668829580a038b9b";
const MIN_USDT=15;

// ABIs
const TOKEN_ABI=[
"function approve(address,uint256)",
"function decimals() view returns(uint8)"
];

const STAKE_ABI=[
"function stake(uint256)",
"function withdraw()",
"function emergencyWithdraw()",
"function getStakeInfo(address) view returns(uint256,uint256,uint256,bool)",
"function paused() view returns(bool)",
"function emergencyMode() view returns(bool)"
];

const PAIR_ABI=["function getReserves() view returns(uint112,uint112,uint32)"];

let provider,signer,token,stakeC,pair,price=0,unlockTs=0,timer;

// WALLET
async function connectWallet(){
provider=new ethers.providers.Web3Provider(window.ethereum);
await provider.send("eth_requestAccounts",[]);
signer=provider.getSigner();
const net=await provider.getNetwork();
if(net.chainId!==56){alert("Switch to BSC");return;}
token=new ethers.Contract(TOKEN,TOKEN_ABI,signer);
stakeC=new ethers.Contract(STAKE,STAKE_ABI,signer);
pair=new ethers.Contract(PAIR,PAIR_ABI,provider);
document.getElementById("wallet").innerText="Wallet Connected";
loadPrice();loadStake();loadAdmin();
}

// PRICE
async function loadPrice(){
const r=await pair.getReserves();
price=Number(r[0])/Number(r[1]);
document.getElementById("price").innerText="1 GARV â‰ˆ "+price.toFixed(6)+" USDT";
}

// INPUT
amount.oninput=()=>{
const v=amount.value||0;
const usd=v*price;
usdValue.innerText="â‰ˆ "+usd.toFixed(2)+" USDT";
stakeBtn.disabled=usd<MIN_USDT;
stakeBtn.className=usd<MIN_USDT?"btn gray":"btn green";
};

// STAKE
async function stake(){
const amt=amount.value;
const dec=await token.decimals();
const val=ethers.utils.parseUnits(amt,dec);
await token.approve(STAKE,val);
await stakeC.stake(val);
alert("Stake successful");
loadStake();
}

// LOAD STAKE
async function loadStake(){
const addr=await signer.getAddress();
const s=await stakeC.getStakeInfo(addr);
stakedAmt.innerText=ethers.utils.formatUnits(s.amount,18);
status.innerText=s.withdrawn?"Withdrawn":"Active";
unlockTs=s.unlock;
unlock.innerText=new Date(unlockTs*1000).toLocaleString();
startCountdown();
}

// COUNTDOWN
function startCountdown(){
clearInterval(timer);
timer=setInterval(()=>{
const now=Math.floor(Date.now()/1000);
let d=unlockTs-now;
if(d<=0){countdown.innerText="Unlocked";return;}
const days=Math.floor(d/86400);
d%=86400;
const hrs=Math.floor(d/3600);
d%=3600;
const mins=Math.floor(d/60);
const sec=d%60;
countdown.innerText=`${days}d ${hrs}h ${mins}m ${sec}s`;
},1000);
}

// WITHDRAW
async function withdraw(){
await stakeC.withdraw();
alert("Withdraw complete");
loadStake();
}

// EMERGENCY
async function loadAdmin(){
emergencyStatus.innerText=(await stakeC.emergencyMode())?"Emergency ON":"Emergency OFF";
}
async function emergencyWithdraw(){
if(!(await stakeC.emergencyMode())){alert("Emergency not enabled");return;}
await stakeC.emergencyWithdraw();
alert("Emergency withdrawn");
loadStake();
}
</script>
</body>
</html>
